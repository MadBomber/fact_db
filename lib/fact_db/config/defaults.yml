# FactDb Bundled Defaults
#
# This file is the SINGLE SOURCE OF TRUTH for FactDb configuration schema.
# All attributes must be declared here (even if nil) to be recognized.
# It is bundled with the gem and loaded automatically at lowest priority.
#
# Loading priority (lowest to highest):
# 1. This file (bundled defaults)
# 2. XDG user config (~/.config/fact_db/fact_db.yml)
# 3. Project config (./config/fact_db.yml)
# 4. Local overrides (./config/fact_db.local.yml)
# 5. Environment variables (FDB_*)
# 6. Programmatic (FactDb.configure block)
#
# Structure:
# - defaults: Base values for all environments (with nested sections)
# - development: Overrides for development environment
# - test: Overrides for test environment
# - production: Overrides for production environment
# - demo: Overrides for demo/staging environment
#
# Custom Environments:
# Your application's config file (./config/fact_db.yml) can define additional
# environments to suit your infrastructure. For example:
#   staging:
#     database:
#       name: myapp_staging
#   qa:
#     database:
#       name: myapp_qa
#
# Environment helper methods (e.g., config.staging?, config.qa?) are
# automatically generated for any environment defined in configuration files.
#
# Access pattern:
#   FactDb.config.database.url
#   FactDb.config.database.pool
#   FactDb.config.llm.provider
#   FactDb.config.ranking.ts_rank_weight

# =============================================================================
# Shared Defaults (base for all environments)
# =============================================================================
defaults:
  # ---------------------------------------------------------------------------
  # Database Configuration (ActiveRecord-compatible keys)
  # Access: FactDb.config.database.url, FactDb.config.database.pool, etc.
  # ---------------------------------------------------------------------------
  database:
    adapter: postgresql
    url: ~
    host: localhost
    port: 5432
    name: fact_db_demo
    username: ~
    password: ~
    pool: 5
    timeout: 30000
    encoding: "unicode"
    prepared_statements: false
    advisory_locks: false

  # ---------------------------------------------------------------------------
  # Embedding Configuration
  # Access: FactDb.config.embedding.generator, FactDb.config.embedding.dimensions
  # ---------------------------------------------------------------------------
  embedding:
    generator: ~
    dimensions: 1536

  # ---------------------------------------------------------------------------
  # LLM Configuration
  # Access: FactDb.config.llm.provider, FactDb.config.llm.model, etc.
  # ---------------------------------------------------------------------------
  llm:
    client: ~
    provider: ~
    model: ~
    api_key: ~

  # ---------------------------------------------------------------------------
  # Ranking Signal Weights
  # Access: FactDb.config.ranking.ts_rank_weight, etc.
  # Weights should sum to approximately 1.0 for normalized scores
  # ---------------------------------------------------------------------------
  ranking:
    ts_rank_weight: 0.25
    vector_similarity_weight: 0.25
    entity_mention_weight: 0.15
    direct_answer_weight: 0.15
    term_overlap_weight: 0.10
    relationship_match_weight: 0.05
    confidence_weight: 0.05

  # ---------------------------------------------------------------------------
  # General Settings
  # Access: FactDb.config.default_extractor, FactDb.config.log_level, etc.
  # ---------------------------------------------------------------------------
  default_extractor: manual
  fuzzy_match_threshold: 0.85
  auto_merge_threshold: 0.95
  log_level: info

  # ---------------------------------------------------------------------------
  # LLM Prompts
  # Access: FactDb.config.prompts.fact_extraction, FactDb.config.prompts.entity_extraction
  # These prompts use %<text>s as a placeholder for the input text.
  # ---------------------------------------------------------------------------
  prompts:
    fact_extraction: |
      Extract ATOMIC factual assertions from the following text. Break compound
      statements into individual, indivisible facts - one assertion per fact.

      For each atomic fact:
      1. State a single, indivisible assertion (not multiple facts combined)
      2. Identify when it became true (valid_at) if mentioned or inferable
      3. Identify when it stopped being true (invalid_at) if mentioned
      4. Identify entities mentioned (people, organizations, places, products)
      5. Assign a confidence score (0.0 to 1.0) based on how explicitly stated the fact is
      6. For each entity, include any aliases or alternative names used in the text

      Text:
      %<text>s

      Return as a JSON array with this structure:
      [
        {
          "text": "Paula works at Microsoft",
          "valid_at": "2024-01-10",
          "invalid_at": null,
          "confidence": 0.95,
          "mentions": [
            {"name": "Paula Chen", "type": "person", "role": "subject", "aliases": ["Paula", "P. Chen"]},
            {"name": "Microsoft", "type": "organization", "role": "object", "aliases": ["MS", "Microsoft Corporation"]}
          ]
        },
        {
          "text": "Paula holds the title of Principal Engineer",
          "valid_at": "2024-01-10",
          "invalid_at": null,
          "confidence": 0.95,
          "mentions": [
            {"name": "Paula Chen", "type": "person", "role": "subject", "aliases": ["Paula", "P. Chen"]}
          ]
        }
      ]

      Rules:
      - ATOMIC FACTS: Break compound statements into smallest meaningful assertions
        - "John and Mary married in Paris" becomes TWO facts: "John married Mary" AND "The marriage took place in Paris"
        - "She is a doctor at City Hospital" becomes TWO facts: "She is a doctor" AND "She works at City Hospital"
      - Extract only factual assertions, not opinions or speculation
      - Use ISO 8601 date format (YYYY-MM-DD) when possible
      - Set invalid_at to null if the fact is still true or unknown
      - Set valid_at to null if the timing is not mentioned
      - Entity types (use ONLY these exact values):
        - person: individual humans
        - organization: companies, governments, institutions, teams, groups
        - place: cities, countries, buildings, geographic locations
        - product: goods, services, software, publications
        - event: wars, battles, elections, conferences, treaties, historical events
        - concept: ideas, theories, abstract notions, fields of study
      - Roles: subject, object, location, temporal, instrument, beneficiary
      - For person entities, use the most complete/formal name as "name" and shorter/alternative forms as "aliases"
      - Common aliases include: nicknames, titles with name, name variations, abbreviations
      - NEVER include pronouns as aliases (he, she, him, her, they, them, his, her, their, it, we, you, I, me, my, etc.)
      - NEVER include generic terms as aliases (man, woman, person, husband, wife, the man, this person, etc.)
      - Only include proper names, nicknames, and formal variations as aliases

      Return only valid JSON, no additional text.

    entity_extraction: |
      Extract all named entities from the following text.
      For each entity:
      1. Identify the canonical name
      2. Classify the type using ONLY these exact values:
         - person: individual humans
         - organization: companies, governments, institutions, teams, groups
         - place: cities, countries, buildings, geographic locations
         - product: goods, services, software, publications
         - event: wars, battles, elections, conferences, treaties, historical events
         - concept: ideas, theories, abstract notions, fields of study
      3. List any aliases or alternative names mentioned

      Text:
      %<text>s

      Return as a JSON array:
      [
        {
          "name": "Paula Chen",
          "type": "person",
          "aliases": ["Paula", "P. Chen"]
        }
      ]

      Important rules for aliases:
      - NEVER include pronouns (he, she, him, her, they, them, his, her, their, it, we, you, I, me, my, etc.)
      - NEVER include generic terms (man, woman, person, husband, wife, the man, this person, believers, disciples, etc.)
      - Only include proper names, nicknames, titles, and formal name variations

      Return only valid JSON, no additional text.

    rag_system: |
      You are a knowledgeable assistant with access to a fact database. Use the provided context to inform your response, but also feel free to synthesize and expand upon the information with related knowledge.

      Your response should:
      1. Directly address the user's question
      2. Include specific facts, names, dates, and details where relevant
      3. Make connections between related pieces of information
      4. Present information in clear, atomic statements that can be extracted as individual facts

# =============================================================================
# Development Environment Overrides
# =============================================================================
development:
  database:
    name: fact_db_development
  log_level: debug

# =============================================================================
# Test Environment Overrides
# =============================================================================
test:
  database:
    name: fact_db_test
    pool: 2
    timeout: 5000
  log_level: warn

# =============================================================================
# Production Environment Overrides
# =============================================================================
production:
  database:
    name: fact_db_production
    pool: 10
    timeout: 60000
  log_level: warn

# =============================================================================
# Demo Environment Overrides
# =============================================================================
demo:
  database:
    name: fact_db_demo
    pool: 3
  log_level: info

# -----------------------------------------------------------------------------
# Add your own environments for your project's infrastructure
# -----------------------------------------------------------------------------
# qa:
# staging:
