<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: FactDb::Temporal::Timeline
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "FactDb::Temporal::Timeline";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (T)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../FactDb.html" title="FactDb (module)">FactDb</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Temporal.html" title="FactDb::Temporal (module)">Temporal</a></span></span>
     &raquo; 
    <span class="title">Timeline</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: FactDb::Temporal::Timeline
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">FactDb::Temporal::Timeline</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>Enumerable</dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/fact_db/temporal/timeline.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Builds and analyzes temporal timelines of facts for an entity</p>

<p>Provides methods to view an entity’s history, group events by time periods, find overlapping facts, and compare states at different points in time. Includes Enumerable for easy iteration over timeline events.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Build a timeline for an entity</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_timeline'>timeline</span> <span class='op'>=</span> <span class='const'>Timeline</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="FactDb::Temporal::Timeline#initialize (method)">new</a></span></span><span class='period'>.</span><span class='id identifier rubyid_build'><span class='object_link'><a href="#build-instance_method" title="FactDb::Temporal::Timeline#build (method)">build</a></span></span><span class='lparen'>(</span><span class='label'>entity_id:</span> <span class='id identifier rubyid_person'>person</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='id identifier rubyid_timeline'>timeline</span><span class='period'>.</span><span class='id identifier rubyid_by_year'>by_year</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_events'>events</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_year'>year</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_content'> events</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Find currently active facts</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_active_facts'>active_facts</span> <span class='op'>=</span> <span class='id identifier rubyid_timeline'>timeline</span><span class='period'>.</span><span class='id identifier rubyid_active'>active</span></code></pre>
    
  </div>


</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#events-instance_method" title="#events (instance method)">#<strong>events</strong>  &#x21d2; Array&lt;TimelineEvent&gt; </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The timeline events.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#active-instance_method" title="#active (instance method)">#<strong>active</strong>  &#x21d2; Array&lt;TimelineEvent&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns currently active (valid) events.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#between-instance_method" title="#between (instance method)">#<strong>between</strong>(from, to)  &#x21d2; Array&lt;TimelineEvent&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns events in a specific date range.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build-instance_method" title="#build (instance method)">#<strong>build</strong>(entity_id:, from: nil, to: nil)  &#x21d2; Timeline </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Builds a timeline of facts for an entity.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#by_month-instance_method" title="#by_month (instance method)">#<strong>by_month</strong>  &#x21d2; Hash&lt;String, Array&lt;TimelineEvent&gt;&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Groups events by month.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#by_year-instance_method" title="#by_year (instance method)">#<strong>by_year</strong>  &#x21d2; Hash&lt;Integer, Array&lt;TimelineEvent&gt;&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Groups events by year.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#changes_summary-instance_method" title="#changes_summary (instance method)">#<strong>changes_summary</strong>  &#x21d2; Array&lt;Hash&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generates a summary of changes between consecutive events.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each-instance_method" title="#each (instance method)">#<strong>each</strong> {|Hash| ... } &#x21d2; Enumerator </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Iterates over timeline event hashes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#historical-instance_method" title="#historical (instance method)">#<strong>historical</strong>  &#x21d2; Array&lt;TimelineEvent&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns historical (no longer valid) events.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>  &#x21d2; Timeline </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initializes a new empty Timeline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#overlapping-instance_method" title="#overlapping (instance method)">#<strong>overlapping</strong>  &#x21d2; Array&lt;Array&lt;TimelineEvent, TimelineEvent&gt;&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Finds pairs of overlapping events.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#state_at-instance_method" title="#state_at (instance method)">#<strong>state_at</strong>(date)  &#x21d2; Array&lt;TimelineEvent&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the state (valid events) at a specific point in time.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_a-instance_method" title="#to_a (instance method)">#<strong>to_a</strong>  &#x21d2; Array&lt;TimelineEvent&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns events sorted by valid_at date.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_hash-instance_method" title="#to_hash (instance method)">#<strong>to_hash</strong>  &#x21d2; Array&lt;Hash&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns events as an array of hashes.</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="FactDb::Temporal::Timeline (class)">Timeline</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initializes a new empty Timeline</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='ivar'>@events</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="events-instance_method">
  
    #<strong>events</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the timeline events.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the timeline events</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 22</span>

<span class='kw'>def</span> <span class='id identifier rubyid_events'>events</span>
  <span class='ivar'>@events</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="active-instance_method">
  
    #<strong>active</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns currently active (valid) events</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>events with no invalid_at date</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


89
90
91</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 89</span>

<span class='kw'>def</span> <span class='id identifier rubyid_active'>active</span>
  <span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:currently_valid?</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="between-instance_method">
  
    #<strong>between</strong>(from, to)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns events in a specific date range</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>from</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>start of range (inclusive)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>to</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>end of range (inclusive)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>events within the range</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


82
83
84</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 82</span>

<span class='kw'>def</span> <span class='id identifier rubyid_between'>between</span><span class='lparen'>(</span><span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='id identifier rubyid_to'>to</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_valid_at'>valid_at</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_from'>from</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_valid_at'>valid_at</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_to'>to</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="build-instance_method">
  
    #<strong>build</strong>(entity_id:, from: nil, to: nil)  &#x21d2; <tt><span class='object_link'><a href="" title="FactDb::Temporal::Timeline (class)">Timeline</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Builds a timeline of facts for an entity</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>entity_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the entity to build timeline for</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>from</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>start of date range (optional)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>to</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>end of date range (optional)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="FactDb::Temporal::Timeline (class)">Timeline</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self for method chaining</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


43
44
45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 43</span>

<span class='kw'>def</span> <span class='id identifier rubyid_build'>build</span><span class='lparen'>(</span><span class='label'>entity_id:</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>to:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_facts'>facts</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_facts'>fetch_facts</span><span class='lparen'>(</span><span class='id identifier rubyid_entity_id'>entity_id</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='id identifier rubyid_to'>to</span><span class='rparen'>)</span>
  <span class='ivar'>@events</span> <span class='op'>=</span> <span class='id identifier rubyid_facts'>facts</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_fact'>fact</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="TimelineEvent.html#initialize-instance_method" title="FactDb::Temporal::TimelineEvent#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_fact'>fact</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="by_month-instance_method">
  
    #<strong>by_month</strong>  &#x21d2; <tt>Hash&lt;String, Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Groups events by month</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash&lt;String, Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>events grouped by “YYYY-MM” key</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 73</span>

<span class='kw'>def</span> <span class='id identifier rubyid_by_month'>by_month</span>
  <span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_valid_at'>valid_at</span><span class='period'>.</span><span class='id identifier rubyid_strftime'>strftime</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%Y-%m</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="by_year-instance_method">
  
    #<strong>by_year</strong>  &#x21d2; <tt>Hash&lt;Integer, Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Groups events by year</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash&lt;Integer, Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>events grouped by year</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


66
67
68</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 66</span>

<span class='kw'>def</span> <span class='id identifier rubyid_by_year'>by_year</span>
  <span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_valid_at'>valid_at</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="changes_summary-instance_method">
  
    #<strong>changes_summary</strong>  &#x21d2; <tt>Array&lt;Hash&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generates a summary of changes between consecutive events</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>array of hashes with :from, :to, and :gap_days keys</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133
134
135
136
137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 129</span>

<span class='kw'>def</span> <span class='id identifier rubyid_changes_summary'>changes_summary</span>
  <span class='id identifier rubyid_sorted'>sorted</span> <span class='op'>=</span> <span class='id identifier rubyid_to_a'>to_a</span>

  <span class='id identifier rubyid_sorted'>sorted</span><span class='period'>.</span><span class='id identifier rubyid_each_cons'>each_cons</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_prev_event'>prev_event</span><span class='comma'>,</span> <span class='id identifier rubyid_next_event'>next_event</span><span class='op'>|</span>
    <span class='lbrace'>{</span>
      <span class='label'>from:</span> <span class='id identifier rubyid_prev_event'>prev_event</span><span class='comma'>,</span>
      <span class='label'>to:</span> <span class='id identifier rubyid_next_event'>next_event</span><span class='comma'>,</span>
      <span class='label'>gap_days:</span> <span class='lparen'>(</span><span class='id identifier rubyid_next_event'>next_event</span><span class='period'>.</span><span class='id identifier rubyid_valid_at'>valid_at</span><span class='period'>.</span><span class='id identifier rubyid_to_date'>to_date</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='id identifier rubyid_prev_event'>prev_event</span><span class='period'>.</span><span class='id identifier rubyid_invalid_at'>invalid_at</span> <span class='op'>||</span> <span class='id identifier rubyid_prev_event'>prev_event</span><span class='period'>.</span><span class='id identifier rubyid_valid_at'>valid_at</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_date'>to_date</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="each-instance_method">
  
    #<strong>each</strong> {|Hash| ... } &#x21d2; <tt>Enumerator</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Iterates over timeline event hashes</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>each event as a hash</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Enumerator</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if no block given</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 33</span>

<span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_to_hash'>to_hash</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="historical-instance_method">
  
    #<strong>historical</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns historical (no longer valid) events</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>events that have been invalidated</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 96</span>

<span class='kw'>def</span> <span class='id identifier rubyid_historical'>historical</span>
  <span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:currently_valid?</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="overlapping-instance_method">
  
    #<strong>overlapping</strong>  &#x21d2; <tt>Array&lt;Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>, <span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Finds pairs of overlapping events</p>

<p>Two events overlap if their validity periods intersect.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>, <span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>pairs of overlapping events</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


105
106
107
108
109
110
111
112
113
114
115
116</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 105</span>

<span class='kw'>def</span> <span class='id identifier rubyid_overlapping'>overlapping</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_sorted'>sorted</span> <span class='op'>=</span> <span class='id identifier rubyid_to_a'>to_a</span>

  <span class='id identifier rubyid_sorted'>sorted</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_sorted'>sorted</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='op'>..</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_other'>other</span><span class='op'>|</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='id identifier rubyid_other'>other</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_events_overlap?'>events_overlap?</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="state_at-instance_method">
  
    #<strong>state_at</strong>(date)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the state (valid events) at a specific point in time</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>date</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the point in time to query</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>events valid at the given date</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


122
123
124</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 122</span>

<span class='kw'>def</span> <span class='id identifier rubyid_state_at'>state_at</span><span class='lparen'>(</span><span class='id identifier rubyid_date'>date</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_valid_at?'>valid_at?</span><span class='lparen'>(</span><span class='id identifier rubyid_date'>date</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_a-instance_method">
  
    #<strong>to_a</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns events sorted by valid_at date</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="TimelineEvent.html" title="FactDb::Temporal::TimelineEvent (class)">TimelineEvent</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>sorted events</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 52</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_a'>to_a</span>
  <span class='ivar'>@events</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:valid_at</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_hash-instance_method">
  
    #<strong>to_hash</strong>  &#x21d2; <tt>Array&lt;Hash&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns events as an array of hashes</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>events converted to hash format</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/temporal/timeline.rb', line 59</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_hash'>to_hash</span>
  <span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_hash</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Jan 13 02:43:37 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-3.3.10).
</div>

    </div>
  </body>
</html>