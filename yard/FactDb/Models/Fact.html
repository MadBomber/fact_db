<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: FactDb::Models::Fact
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "FactDb::Models::Fact";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (F)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../FactDb.html" title="FactDb (module)">FactDb</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Models.html" title="FactDb::Models (module)">Models</a></span></span>
     &raquo; 
    <span class="title">Fact</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: FactDb::Models::Fact
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">ActiveRecord::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveRecord::Base</li>
          
            <li class="next">FactDb::Models::Fact</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/fact_db/models/fact.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Represents a temporal fact in the database</p>

<p>Facts are the core data structure in FactDb, representing statements with temporal validity (valid_at/invalid_at), entity mentions, and source provenance. Facts can be canonical, superseded, or synthesized from other facts.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Create a fact</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_fact'>fact</span> <span class='op'>=</span> <span class='const'>Fact</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span>
  <span class='label'>text:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>John works at Acme Corp</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='label'>valid_at:</span> <span class='const'>Date</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2024-01-15</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
  <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>canonical</span><span class='tstring_end'>&quot;</span></span>
<span class='rparen'>)</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Query currently valid facts</p>
</div></h5>
      
      <pre class="example code"><code><span class='const'>Fact</span><span class='period'>.</span><span class='id identifier rubyid_canonical'><span class='object_link'><a href="#canonical-instance_method" title="FactDb::Models::Fact#canonical (method)">canonical</a></span></span><span class='period'>.</span><span class='id identifier rubyid_currently_valid'>currently_valid</span></code></pre>
    
  </div>


</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="STATUSES-constant" class="">STATUSES =
          <div class="docstring">
  <div class="discussion">
    
<p>Returns valid fact statuses.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>valid fact statuses</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='qwords_beg'>%w[</span><span class='tstring_content'>canonical</span><span class='words_sep'> </span><span class='tstring_content'>superseded</span><span class='words_sep'> </span><span class='tstring_content'>corroborated</span><span class='words_sep'> </span><span class='tstring_content'>synthesized</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="EXTRACTION_METHODS-constant" class="">EXTRACTION_METHODS =
          <div class="docstring">
  <div class="discussion">
    
<p>Returns valid extraction methods.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>valid extraction methods</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='qwords_beg'>%w[</span><span class='tstring_content'>manual</span><span class='words_sep'> </span><span class='tstring_content'>llm</span><span class='words_sep'> </span><span class='tstring_content'>rule_based</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Scopes
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#became_invalid_between-instance_method" title="#became_invalid_between (instance method)">#<strong>became_invalid_between</strong>(from, to)  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts that became invalid within a date range.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#became_valid_between-instance_method" title="#became_valid_between (instance method)">#<strong>became_valid_between</strong>(from, to)  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts that became valid within a date range.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#by_extraction_method-instance_method" title="#by_extraction_method (instance method)">#<strong>by_extraction_method</strong>(method)  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Alias for extracted_by.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#canonical-instance_method" title="#canonical (instance method)">#<strong>canonical</strong>  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts with canonical status.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#currently_valid-instance_method" title="#currently_valid (instance method)">#<strong>currently_valid</strong>  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts that are currently valid (no invalid_at date).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#extracted_by-instance_method" title="#extracted_by (instance method)">#<strong>extracted_by</strong>(method)  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts extracted by a specific method.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#high_confidence-instance_method" title="#high_confidence (instance method)">#<strong>high_confidence</strong>  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts with confidence &gt;= 0.9.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#historical-instance_method" title="#historical (instance method)">#<strong>historical</strong>  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts that have been invalidated.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#low_confidence-instance_method" title="#low_confidence (instance method)">#<strong>low_confidence</strong>  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts with confidence &lt; 0.5.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mentioning_entity-instance_method" title="#mentioning_entity (instance method)">#<strong>mentioning_entity</strong>(entity_id)  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts that mention a specific entity.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#search_text-instance_method" title="#search_text (instance method)">#<strong>search_text</strong>(query)  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Full-text search on fact text using PostgreSQL tsvector.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#superseded-instance_method" title="#superseded (instance method)">#<strong>superseded</strong>  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts that have been superseded.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#synthesized-instance_method" title="#synthesized (instance method)">#<strong>synthesized</strong>  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts that were synthesized from other facts.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valid_at-instance_method" title="#valid_at (instance method)">#<strong>valid_at</strong>(date)  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts valid at a specific point in time.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valid_between-instance_method" title="#valid_between (instance method)">#<strong>valid_between</strong>(from, to)  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts valid during a date range.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with_role-instance_method" title="#with_role (instance method)">#<strong>with_role</strong>(entity_id, role)  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts where an entity has a specific role.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#nearest_neighbors-class_method" title="nearest_neighbors (class method)">.<strong>nearest_neighbors</strong>(embedding, limit: 10)  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Finds facts by vector similarity using pgvector.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_mention-instance_method" title="#add_mention (instance method)">#<strong>add_mention</strong>(entity:, text:, role: nil, confidence: 1.0)  &#x21d2; FactDb::Models::EntityMention </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds an entity mention to this fact.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_source-instance_method" title="#add_source (instance method)">#<strong>add_source</strong>(source:, kind: &quot;primary&quot;, excerpt: nil, confidence: 1.0)  &#x21d2; FactDb::Models::FactSource </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds a source document to this fact.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#corroborating_facts-instance_method" title="#corroborating_facts (instance method)">#<strong>corroborating_facts</strong>  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns facts that corroborate this one.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#currently_valid%3F-instance_method" title="#currently_valid? (instance method)">#<strong>currently_valid?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if the fact is currently valid.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#duration-instance_method" title="#duration (instance method)">#<strong>duration</strong>  &#x21d2; ActiveSupport::Duration<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the duration the fact was valid.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#duration_days-instance_method" title="#duration_days (instance method)">#<strong>duration_days</strong>  &#x21d2; Integer<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the duration in days the fact was valid.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#evidence_chain-instance_method" title="#evidence_chain (instance method)">#<strong>evidence_chain</strong>  &#x21d2; Array&lt;FactDb::Models::Source&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the complete evidence chain back to original sources.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#invalidate!-instance_method" title="#invalidate! (instance method)">#<strong>invalidate!</strong>(at: Time.current)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Invalidates this fact at a specific time.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prove_it-instance_method" title="#prove_it (instance method)">#<strong>prove_it</strong>  &#x21d2; Hash<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the original source lines from which this fact was derived.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#source_facts-instance_method" title="#source_facts (instance method)">#<strong>source_facts</strong>  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the source facts for synthesized facts.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#supersede_with!-instance_method" title="#supersede_with! (instance method)">#<strong>supersede_with!</strong>(new_text, valid_at:)  &#x21d2; FactDb::Models::Fact </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Supersedes this fact with new information.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#superseded%3F-instance_method" title="#superseded? (instance method)">#<strong>superseded?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if this fact has been superseded.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#synthesized%3F-instance_method" title="#synthesized? (instance method)">#<strong>synthesized?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if this fact was synthesized from other facts.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valid_at%3F-instance_method" title="#valid_at? (instance method)">#<strong>valid_at?</strong>(date)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if the fact was valid at a specific date.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="nearest_neighbors-class_method">
  
    .<strong>nearest_neighbors</strong>(embedding, limit: 10)  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Finds facts by vector similarity using pgvector</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>embedding</span>
      
      
        <span class='type'>(<tt>Array&lt;Float&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the embedding vector to search with</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>limit</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>10</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>maximum number of results</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>facts ordered by similarity</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


410
411
412
413
414</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 410</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_nearest_neighbors'>nearest_neighbors</span><span class='lparen'>(</span><span class='id identifier rubyid_embedding'>embedding</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='int'>10</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_none'>none</span> <span class='kw'>unless</span> <span class='id identifier rubyid_embedding'>embedding</span>

  <span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='const'>Arel</span><span class='period'>.</span><span class='id identifier rubyid_sql'>sql</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>embedding &lt;=&gt; &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_embedding'>embedding</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='id identifier rubyid_limit'>limit</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_mention-instance_method">
  
    #<strong>add_mention</strong>(entity:, text:, role: nil, confidence: 1.0)  &#x21d2; <tt><span class='object_link'><a href="EntityMention.html" title="FactDb::Models::EntityMention (class)">FactDb::Models::EntityMention</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds an entity mention to this fact</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>entity</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Entity.html" title="FactDb::Models::Entity (class)">FactDb::Models::Entity</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the entity being mentioned</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>text</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the mention text as it appears in the fact</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>role</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the role (subject, object, etc.)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>confidence</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1.0</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>confidence score (0.0 to 1.0)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="EntityMention.html" title="FactDb::Models::EntityMention (class)">FactDb::Models::EntityMention</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the created or found mention</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


255
256
257
258
259
260</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 255</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_mention'>add_mention</span><span class='lparen'>(</span><span class='label'>entity:</span><span class='comma'>,</span> <span class='label'>text:</span><span class='comma'>,</span> <span class='label'>role:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>confidence:</span> <span class='float'>1.0</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_entity_mentions'>entity_mentions</span><span class='period'>.</span><span class='id identifier rubyid_find_or_create_by!'>find_or_create_by!</span><span class='lparen'>(</span><span class='label'>entity:</span> <span class='id identifier rubyid_entity'>entity</span><span class='comma'>,</span> <span class='label'>mention_text:</span> <span class='id identifier rubyid_text'>text</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span>
    <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_mention_role'>mention_role</span> <span class='op'>=</span> <span class='id identifier rubyid_role'>role</span>
    <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_confidence'>confidence</span> <span class='op'>=</span> <span class='id identifier rubyid_confidence'>confidence</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add_source-instance_method">
  
    #<strong>add_source</strong>(source:, kind: &quot;primary&quot;, excerpt: nil, confidence: 1.0)  &#x21d2; <tt><span class='object_link'><a href="FactSource.html" title="FactDb::Models::FactSource (class)">FactDb::Models::FactSource</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds a source document to this fact</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>source</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Source.html" title="FactDb::Models::Source (class)">FactDb::Models::Source</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the source document</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>kind</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;primary&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>source kind (primary, corroborating, etc.)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>excerpt</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>relevant excerpt from the source</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>confidence</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1.0</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>confidence score (0.0 to 1.0)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="FactSource.html" title="FactDb::Models::FactSource (class)">FactDb::Models::FactSource</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the created or found fact-source link</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


269
270
271
272
273
274
275</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 269</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_source'>add_source</span><span class='lparen'>(</span><span class='label'>source:</span><span class='comma'>,</span> <span class='label'>kind:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>primary</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>excerpt:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>confidence:</span> <span class='float'>1.0</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fact_sources'>fact_sources</span><span class='period'>.</span><span class='id identifier rubyid_find_or_create_by!'>find_or_create_by!</span><span class='lparen'>(</span><span class='label'>source:</span> <span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
    <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_kind'>kind</span> <span class='op'>=</span> <span class='id identifier rubyid_kind'>kind</span>
    <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_excerpt'>excerpt</span> <span class='op'>=</span> <span class='id identifier rubyid_excerpt'>excerpt</span>
    <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_confidence'>confidence</span> <span class='op'>=</span> <span class='id identifier rubyid_confidence'>confidence</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="became_invalid_between-instance_method">
  
    #<strong>became_invalid_between</strong>(from, to)  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts that became invalid within a date range</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>from</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>start of range</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>to</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>end of range</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


112
113
114</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 112</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:became_invalid_between</span><span class='comma'>,</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='id identifier rubyid_to'>to</span><span class='op'>|</span>
  <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>invalid_at:</span> <span class='id identifier rubyid_from'>from</span><span class='op'>..</span><span class='id identifier rubyid_to'>to</span><span class='rparen'>)</span>
<span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="became_valid_between-instance_method">
  
    #<strong>became_valid_between</strong>(from, to)  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts that became valid within a date range</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>from</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>start of range</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>to</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>end of range</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 103</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:became_valid_between</span><span class='comma'>,</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='id identifier rubyid_to'>to</span><span class='op'>|</span>
  <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>valid_at:</span> <span class='id identifier rubyid_from'>from</span><span class='op'>..</span><span class='id identifier rubyid_to'>to</span><span class='rparen'>)</span>
<span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="by_extraction_method-instance_method">
  
    #<strong>by_extraction_method</strong>(method)  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Alias for extracted_by</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>method</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>extraction method</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


153</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 153</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:by_extraction_method</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>extraction_method:</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span> <span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="canonical-instance_method">
  
    #<strong>canonical</strong>  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts with canonical status</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 58</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:canonical</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>canonical</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="corroborating_facts-instance_method">
  
    #<strong>corroborating_facts</strong>  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts that corroborate this one</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>corroborating facts</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


289
290
291
292
293</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 289</span>

<span class='kw'>def</span> <span class='id identifier rubyid_corroborating_facts'>corroborating_facts</span>
  <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="" title="FactDb::Models::Fact (class)">Fact</a></span></span><span class='period'>.</span><span class='id identifier rubyid_none'>none</span> <span class='kw'>unless</span> <span class='id identifier rubyid_corroborated_by_ids'>corroborated_by_ids</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>

  <span class='const'><span class='object_link'><a href="" title="FactDb::Models::Fact (class)">Fact</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_corroborated_by_ids'>corroborated_by_ids</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="currently_valid-instance_method">
  
    #<strong>currently_valid</strong>  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts that are currently valid (no invalid_at date)</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 73</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:currently_valid</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>invalid_at:</span> <span class='kw'>nil</span><span class='rparen'>)</span> <span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="currently_valid?-instance_method">
  
    #<strong>currently_valid?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if the fact is currently valid</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>true if the fact has no invalid_at date</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


170
171
172</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 170</span>

<span class='kw'>def</span> <span class='id identifier rubyid_currently_valid?'>currently_valid?</span>
  <span class='id identifier rubyid_invalid_at'>invalid_at</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="duration-instance_method">
  
    #<strong>duration</strong>  &#x21d2; <tt>ActiveSupport::Duration</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the duration the fact was valid</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveSupport::Duration</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>duration or nil if still valid</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


185
186
187
188
189</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 185</span>

<span class='kw'>def</span> <span class='id identifier rubyid_duration'>duration</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_invalid_at'>invalid_at</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_invalid_at'>invalid_at</span> <span class='op'>-</span> <span class='id identifier rubyid_valid_at'>valid_at</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="duration_days-instance_method">
  
    #<strong>duration_days</strong>  &#x21d2; <tt>Integer</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the duration in days the fact was valid</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>number of days or nil if still valid</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196
197
198</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 194</span>

<span class='kw'>def</span> <span class='id identifier rubyid_duration_days'>duration_days</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_invalid_at'>invalid_at</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='lparen'>(</span><span class='id identifier rubyid_invalid_at'>invalid_at</span><span class='period'>.</span><span class='id identifier rubyid_to_date'>to_date</span> <span class='op'>-</span> <span class='id identifier rubyid_valid_at'>valid_at</span><span class='period'>.</span><span class='id identifier rubyid_to_date'>to_date</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="evidence_chain-instance_method">
  
    #<strong>evidence_chain</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="Source.html" title="FactDb::Models::Source (class)">FactDb::Models::Source</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the complete evidence chain back to original sources</p>

<p>Recursively traces through synthesized facts to find all original sources.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Source.html" title="FactDb::Models::Source (class)">FactDb::Models::Source</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique source documents</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


300
301
302
303
304
305
306
307
308
309
310</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 300</span>

<span class='kw'>def</span> <span class='id identifier rubyid_evidence_chain'>evidence_chain</span>
  <span class='id identifier rubyid_evidence'>evidence</span> <span class='op'>=</span> <span class='id identifier rubyid_sources'>sources</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_synthesized?'>synthesized?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_derived_from_ids'>derived_from_ids</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
    <span class='id identifier rubyid_source_facts'>source_facts</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_source_fact'>source_fact</span><span class='op'>|</span>
      <span class='id identifier rubyid_evidence'>evidence</span><span class='period'>.</span><span class='id identifier rubyid_concat'>concat</span><span class='lparen'>(</span><span class='id identifier rubyid_source_fact'>source_fact</span><span class='period'>.</span><span class='id identifier rubyid_evidence_chain'>evidence_chain</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_evidence'>evidence</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="extracted_by-instance_method">
  
    #<strong>extracted_by</strong>(method)  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts extracted by a specific method</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>method</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>extraction method (manual, llm, rule_based)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 147</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:extracted_by</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>extraction_method:</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span> <span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="high_confidence-instance_method">
  
    #<strong>high_confidence</strong>  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts with confidence &gt;= 0.9</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


158</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 158</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:high_confidence</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>confidence &gt;= ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='float'>0.9</span><span class='rparen'>)</span> <span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="historical-instance_method">
  
    #<strong>historical</strong>  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts that have been invalidated</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 78</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:historical</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='period'>.</span><span class='id identifier rubyid_not'>not</span><span class='lparen'>(</span><span class='label'>invalid_at:</span> <span class='kw'>nil</span><span class='rparen'>)</span> <span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="invalidate!-instance_method">
  
    #<strong>invalidate!</strong>(at: Time.current)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Invalidates this fact at a specific time</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>at</span>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>Time.current</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>when the fact became invalid (defaults to now)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>true if update succeeded</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


218
219
220</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 218</span>

<span class='kw'>def</span> <span class='id identifier rubyid_invalidate!'>invalidate!</span><span class='lparen'>(</span><span class='label'>at:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_update!'>update!</span><span class='lparen'>(</span><span class='label'>invalid_at:</span> <span class='id identifier rubyid_at'>at</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="low_confidence-instance_method">
  
    #<strong>low_confidence</strong>  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts with confidence &lt; 0.5</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 163</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:low_confidence</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>confidence &lt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='float'>0.5</span><span class='rparen'>)</span> <span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mentioning_entity-instance_method">
  
    #<strong>mentioning_entity</strong>(entity_id)  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts that mention a specific entity</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>entity_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the entity ID</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


120
121
122</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 120</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:mentioning_entity</span><span class='comma'>,</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_entity_id'>entity_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_joins'>joins</span><span class='lparen'>(</span><span class='symbol'>:entity_mentions</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>fact_db_entity_mentions:</span> <span class='lbrace'>{</span> <span class='label'>entity_id:</span> <span class='id identifier rubyid_entity_id'>entity_id</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_distinct'>distinct</span>
<span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="prove_it-instance_method">
  
    #<strong>prove_it</strong>  &#x21d2; <tt>Hash</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the original source lines from which this fact was derived</p>

<p>Uses line metadata to extract the relevant section from the source document and highlights lines containing key terms from the fact.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_fact'>fact</span><span class='period'>.</span><span class='id identifier rubyid_prove_it'>prove_it</span>
<span class='comment'># =&gt; {
</span><span class='comment'>#   full_section: &quot;...&quot;,
</span><span class='comment'>#   focused_lines: &quot;John joined Acme Corp...&quot;,
</span><span class='comment'>#   focused_line_numbers: [15, 16],
</span><span class='comment'>#   key_terms: [&quot;John&quot;, &quot;Acme Corp&quot;]
</span><span class='comment'># }</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>hash with :full_section, :focused_lines, :focused_line_numbers, :key_terms or nil if source/line metadata unavailable</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 328</span>

<span class='kw'>def</span> <span class='id identifier rubyid_prove_it'>prove_it</span>
  <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='id identifier rubyid_fact_sources'>fact_sources</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='op'>&amp;.</span><span class='id identifier rubyid_source'>source</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_source'>source</span><span class='op'>&amp;.</span><span class='id identifier rubyid_content'>content</span>

  <span class='id identifier rubyid_line_start'>line_start</span> <span class='op'>=</span> <span class='id identifier rubyid_metadata'>metadata</span><span class='op'>&amp;.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>line_start</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_line_end'>line_end</span> <span class='op'>=</span> <span class='id identifier rubyid_metadata'>metadata</span><span class='op'>&amp;.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>line_end</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_line_start'>line_start</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_line_end'>line_end</span>

  <span class='id identifier rubyid_lines'>lines</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span><span class='period'>.</span><span class='id identifier rubyid_lines'>lines</span>
  <span class='id identifier rubyid_start_idx'>start_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_line_start'>line_start</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>-</span> <span class='int'>1</span>
  <span class='id identifier rubyid_end_idx'>end_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_line_end'>line_end</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>-</span> <span class='int'>1</span>

  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_start_idx'>start_idx</span> <span class='op'>&lt;</span> <span class='int'>0</span> <span class='op'>||</span> <span class='id identifier rubyid_end_idx'>end_idx</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_lines'>lines</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>

  <span class='id identifier rubyid_section_lines'>section_lines</span> <span class='op'>=</span> <span class='id identifier rubyid_lines'>lines</span><span class='lbracket'>[</span><span class='id identifier rubyid_start_idx'>start_idx</span><span class='op'>..</span><span class='id identifier rubyid_end_idx'>end_idx</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_full_section'>full_section</span> <span class='op'>=</span> <span class='id identifier rubyid_section_lines'>section_lines</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>

  <span class='comment'># Find focused lines by matching key terms from fact
</span>  <span class='id identifier rubyid_key_terms'>key_terms</span> <span class='op'>=</span> <span class='id identifier rubyid_extract_key_terms'>extract_key_terms</span>
  <span class='id identifier rubyid_scored_lines'>scored_lines</span> <span class='op'>=</span> <span class='id identifier rubyid_score_lines_by_relevance'>score_lines_by_relevance</span><span class='lparen'>(</span><span class='id identifier rubyid_section_lines'>section_lines</span><span class='comma'>,</span> <span class='id identifier rubyid_key_terms'>key_terms</span><span class='comma'>,</span> <span class='id identifier rubyid_start_idx'>start_idx</span><span class='rparen'>)</span>

  <span class='comment'># Return lines that have at least one match, sorted by line number
</span>  <span class='id identifier rubyid_relevant'>relevant</span> <span class='op'>=</span> <span class='id identifier rubyid_scored_lines'>scored_lines</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_l'>l</span><span class='op'>|</span> <span class='id identifier rubyid_l'>l</span><span class='lbracket'>[</span><span class='symbol'>:score</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='rbrace'>}</span>
                         <span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_l'>l</span><span class='op'>|</span> <span class='id identifier rubyid_l'>l</span><span class='lbracket'>[</span><span class='symbol'>:line_number</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>

  <span class='lbrace'>{</span>
    <span class='label'>full_section:</span> <span class='id identifier rubyid_full_section'>full_section</span><span class='comma'>,</span>
    <span class='label'>focused_lines:</span> <span class='id identifier rubyid_relevant'>relevant</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_l'>l</span><span class='op'>|</span> <span class='id identifier rubyid_l'>l</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='comma'>,</span>
    <span class='label'>focused_line_numbers:</span> <span class='id identifier rubyid_relevant'>relevant</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_l'>l</span><span class='op'>|</span> <span class='id identifier rubyid_l'>l</span><span class='lbracket'>[</span><span class='symbol'>:line_number</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='label'>key_terms:</span> <span class='id identifier rubyid_key_terms'>key_terms</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="search_text-instance_method">
  
    #<strong>search_text</strong>(query)  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Full-text search on fact text using PostgreSQL tsvector</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>query</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the search query</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 139</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:search_text</span><span class='comma'>,</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_query'>query</span><span class='op'>|</span>
  <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to_tsvector(&#39;english&#39;, text) @@ plainto_tsquery(&#39;english&#39;, ?)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span>
<span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="source_facts-instance_method">
  
    #<strong>source_facts</strong>  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the source facts for synthesized facts</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>facts this one was derived from</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


280
281
282
283
284</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 280</span>

<span class='kw'>def</span> <span class='id identifier rubyid_source_facts'>source_facts</span>
  <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="" title="FactDb::Models::Fact (class)">Fact</a></span></span><span class='period'>.</span><span class='id identifier rubyid_none'>none</span> <span class='kw'>unless</span> <span class='id identifier rubyid_derived_from_ids'>derived_from_ids</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>

  <span class='const'><span class='object_link'><a href="" title="FactDb::Models::Fact (class)">Fact</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_derived_from_ids'>derived_from_ids</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="supersede_with!-instance_method">
  
    #<strong>supersede_with!</strong>(new_text, valid_at:)  &#x21d2; <tt><span class='object_link'><a href="" title="FactDb::Models::Fact (class)">FactDb::Models::Fact</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Supersedes this fact with new information</p>

<p>Creates a new canonical fact and marks this one as superseded.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>new_text</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the updated fact text</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>valid_at</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>when the new fact became valid</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="FactDb::Models::Fact (class)">FactDb::Models::Fact</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the new fact</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 229</span>

<span class='kw'>def</span> <span class='id identifier rubyid_supersede_with!'>supersede_with!</span><span class='lparen'>(</span><span class='id identifier rubyid_new_text'>new_text</span><span class='comma'>,</span> <span class='label'>valid_at:</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_new_fact'>new_fact</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span>
      <span class='label'>text:</span> <span class='id identifier rubyid_new_text'>new_text</span><span class='comma'>,</span>
      <span class='label'>valid_at:</span> <span class='id identifier rubyid_valid_at'>valid_at</span><span class='comma'>,</span>
      <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>canonical</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>extraction_method:</span> <span class='id identifier rubyid_extraction_method'>extraction_method</span>
    <span class='rparen'>)</span>

    <span class='id identifier rubyid_update!'>update!</span><span class='lparen'>(</span>
      <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>superseded</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>superseded_by_id:</span> <span class='id identifier rubyid_new_fact'>new_fact</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
      <span class='label'>invalid_at:</span> <span class='id identifier rubyid_valid_at'>valid_at</span>
    <span class='rparen'>)</span>

    <span class='id identifier rubyid_new_fact'>new_fact</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="superseded-instance_method">
  
    #<strong>superseded</strong>  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts that have been superseded</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 63</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:superseded</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>superseded</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="superseded?-instance_method">
  
    #<strong>superseded?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if this fact has been superseded</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>true if status is superseded</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


203
204
205</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 203</span>

<span class='kw'>def</span> <span class='id identifier rubyid_superseded?'>superseded?</span>
  <span class='id identifier rubyid_status'>status</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>superseded</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="synthesized-instance_method">
  
    #<strong>synthesized</strong>  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts that were synthesized from other facts</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 68</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:synthesized</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>synthesized</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="synthesized?-instance_method">
  
    #<strong>synthesized?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if this fact was synthesized from other facts</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>true if status is synthesized</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 210</span>

<span class='kw'>def</span> <span class='id identifier rubyid_synthesized?'>synthesized?</span>
  <span class='id identifier rubyid_status'>status</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>synthesized</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="valid_at-instance_method">
  
    #<strong>valid_at</strong>(date)  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts valid at a specific point in time</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>date</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the point in time</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 84</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:valid_at</span><span class='comma'>,</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_date'>date</span><span class='op'>|</span>
  <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>valid_at &lt;= ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_date'>date</span><span class='rparen'>)</span>
    <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid_at &gt; ? OR invalid_at IS NULL</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_date'>date</span><span class='rparen'>)</span>
<span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="valid_at?-instance_method">
  
    #<strong>valid_at?</strong>(date)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if the fact was valid at a specific date</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>date</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the point in time to check</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>true if the fact was valid at the given date</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


178
179
180</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 178</span>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_at?'>valid_at?</span><span class='lparen'>(</span><span class='id identifier rubyid_date'>date</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_valid_at'>valid_at</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_date'>date</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_invalid_at'>invalid_at</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_invalid_at'>invalid_at</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_date'>date</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="valid_between-instance_method">
  
    #<strong>valid_between</strong>(from, to)  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts valid during a date range</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>from</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>start of range</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>to</span>
      
      
        <span class='type'>(<tt>Date</tt>, <tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>end of range</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


94
95
96</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 94</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:valid_between</span><span class='comma'>,</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='id identifier rubyid_to'>to</span><span class='op'>|</span>
  <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>valid_at &lt;= ? AND (invalid_at &gt; ? OR invalid_at IS NULL)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_to'>to</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='rparen'>)</span>
<span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with_role-instance_method">
  
    #<strong>with_role</strong>(entity_id, role)  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns facts where an entity has a specific role</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>entity_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the entity ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>role</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the mention role (subject, object, etc.)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fact_db/models/fact.rb', line 129</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:with_role</span><span class='comma'>,</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_entity_id'>entity_id</span><span class='comma'>,</span> <span class='id identifier rubyid_role'>role</span><span class='op'>|</span>
  <span class='id identifier rubyid_joins'>joins</span><span class='lparen'>(</span><span class='symbol'>:entity_mentions</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span>
    <span class='label'>fact_db_entity_mentions:</span> <span class='lbrace'>{</span> <span class='label'>entity_id:</span> <span class='id identifier rubyid_entity_id'>entity_id</span><span class='comma'>,</span> <span class='label'>mention_role:</span> <span class='id identifier rubyid_role'>role</span> <span class='rbrace'>}</span>
  <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_distinct'>distinct</span>
<span class='rbrace'>}</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Jan 13 02:43:37 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-3.3.10).
</div>

    </div>
  </body>
</html>